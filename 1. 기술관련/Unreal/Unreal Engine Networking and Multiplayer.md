# 클라이언트-서버 모델 멀티플레이 게임

## 개요

클라이언트-서버 모델은 멀티플레이어 게임에서 하나의 컴퓨터가 **서버**가 되어 게임 세션을 호스팅하고, 나머지 플레이어의 컴퓨터는 **클라이언트**로 작동합니다.

### 역할

- **서버**: 게임의 핵심 로직과 진행이 이루어지는 장소.
    
- **클라이언트**: 서버에서 소유한 폰(Pawn)을 원격 제어하고, **Remote Procedure Call**(RPC)을 통해 게임 내 액션을 수행합니다.
    

## 기본 네트워킹 개념

### 네트워크 모드 및 서버 유형

1. **독립형(Standalone)**
    
    - 싱글 플레이 및 로컬 멀티플레이 게임에 사용.
        
    - 서버-클라이언트 통신이 필요하지 않음.
        
2. **클라이언트(Client)**
    
    - 서버에 연결된 클라이언트로 실행.
        
    - 서버 측 로직을 실행하지 않음.
        
3. **리슨 서버(Listen Server)**
    
    - 게임 세션을 호스팅하면서 동시에 로컬 플레이어를 지원.
        
    - 서버 역할과 로컬 플레이어 기능을 동시에 수행.
        
4. **데디케이트 서버(Dedicated Server)**
    
    - 리슨 서버와 유사하지만 로컬 플레이어가 존재하지 않음.
        
    - 다수의 연결을 효율적으로 처리할 수 있도록 최적화.
        

---

# 엑터 리플리케이션

## 개요

엑터 리플리케이션은 네트워크 세션에 있는 다양한 컴퓨터 간에 게임 상태 정보를 재현하는 프로세스입니다.

## 기능

1. **생성 및 소멸**
    
    - 서버에서 Authority가 있는 엑터가 생성(Spawn)되면, 접속된 모든 클라이언트에 원격 프록시가 자동으로 생성되고 정보가 리플리케이트됩니다.
        
    - Authority가 있는 엑터가 소멸되면, 접속된 모든 클라이언트의 원격 프록시가 자동으로 제거됩니다.
        
2. **무브먼트 리플리케이션**
    
    - 위치(Location), 회전(Rotation), 속도(Velocity)가 리플리케이트됩니다.
        
3. **변수 리플리케이션**
    
    - 값이 변경될 때마다 Authority가 있는 엑터에서 원격 프록시로 자동 리플리케이트됩니다.
        
4. **컴포넌트 리플리케이션**
    
    - 엑터의 컴포넌트가 엑터의 일부로 리플리케이트됩니다.
        
    - 지정된 컴포넌트 내의 모든 변수가 리플리케이트되며, 컴포넌트 내에서 호출된 RPC는 엑터 클래스에서 호출된 RPC와 일관되게 동작합니다.
        
5. **원격 프로시저 호출 (RPC)**
    
    - 특정 컴퓨터로 전송되는 특별한 함수입니다.
        
    - 지정된 컴퓨터에서 구현이 실행됩니다.
        
        - **서버(Server)**: 서버에서만 실행.
            
        - **클라이언트(Client)**: 엑터 소유 클라이언트에서만 실행.
            
        - **Multicast**: 서버를 포함해 세션에 접속된 모든 컴퓨터에서 실행.
            

> 생성 및 소멸, 무브먼트 같은 일반적인 사용 사례는 자동으로 처리되지만, 리플리케이션을 활성화해도 다른 모든 게임플레이 피처는 기본적으로 자동으로 리플리케이트되지 않습니다. 게임에 적합하도록 리플리케이트하려는 변수와 함수를 정확하게 지정해야 합니다.

참고: [Unreal Engine 리플리케이션 문서](https://dev.epicgames.com/documentation/ko-kr/unreal-engine/replicate-actor-properties-in-unreal-engine?application_version=5.4)

## 변수 리플리케이션
오소리티 있는 액터에서 리플리케이티드 변수의 값이 변경될 때마다, 해당 정보가 자동으로 오소리티 있는 액터에서 세션에 접속된 원격 프록시로 전송됩니다.
### RepNotifies
특정 변수의 리플리케이트된 정보를 성공적으로 수신한 액터에 대한 응답으로 호출되는 **RepNotify** 함수를 지정할 수 있습니다. RepNotify는 변수가 업데이트될 때 로컬에서만 트리거되므로, 오소리티 있는 액터의 변수 변경에 대한 응답으로 오버헤드가 적게 게임플레이 로직을 트리거하는 방법입니다.
- RepNotifies는 리플리케이트가 필요한 변수에 추가할 수 있어 RPC 또는 리플리케이트 함수를 사용하는 것 보다 선호되며, 추가 네트워크 후출을 생성하는 것에 비해 대역폭을 상당히 절감할 수 있다.
## 원격 프로시저 호출(RPC)
원격 프로시저 호출(RPC)는 리플리케이티드 함수라고도 합니다. 모든 컴퓨터에서 호출할 수 있지만, 네트워크 세션에 접속된 특정 컴퓨터에서 구현되도록 지시됩니다.

### RPC 타입
1. **서버(Server)** 
	- 게임을 호스팅하는 서버에서만 호출됨.
2. **클라이언트(Client)**
	- 함수가 속한 액터를 소유한 클라이언트에서만 호출됨.
3. NetMulticast 
	- 서버에 접속된 모든 클라이언트와 서버 자체에 호출됨
### 신뢰성
- **비신뢰성 RPC**는 의도한 목적지 도착이 보장되지 않지만, 신뢰성 RPC보다 더 자주, 더 빨리 전송할 수 있습니다.
- **신뢰성 RPC**는 의도한 목적지 도착을 보장하며, 성공적으로 수신될 때까지 큐에 남아 있습니다. 신뢰성 함수를 과도하게 사용하면 해당 함수의 큐가 오버플로우될 수 있습니다.
### 유효성 검사
`WithValidation` 지정자는 함수 구현 외에도 들어오는 함수 호출의 데이터 유효성을 검사하는 함수도 있다는 사실을 나타냅니다.

---

# 네트워크 역할 및 Authority

## 개요

액터의 **네트워크 역할**은 네트워크 게임 중 액터를 제어할 컴퓨터를 결정합니다. **Authority** 있는 엑터는 액터의 상태를 제어하며, 정보를 네트워크 멀티플레이어 세션 내에 있는 다른 컴퓨터로 리플리케이트합니다. **원격 프록시**는 원격 컴퓨터에 있는 해당 엑터의 사본으로, Authority가 있는 엑터로부터 리플리케이트된 정보를 수신합니다.

## 네트워크 역할

1. **None(없음)**
    
    - 엑터가 네트워크 게임에서 역할이 없으며 리플리케이트하지 않음.
        
2. **Authority(오소리티)**
    
    - 엑터가 Authority가 있는 엑터이며, 다른 컴퓨터에 있는 원격 프록시로 정보를 리플리케이트함.
        
3. **Simulated Proxy(시뮬레이션된 프록시)**
    
    - 엑터가 다른 컴퓨터의 Authority가 있는 엑터에 의해 완전히 제어되는 원격 프록시.
        
4. **Autonomous Proxy(자율 프록시)**
    
    - 엑터가 일부 함수를 로컬에서 수행할 수 있지만, Authority가 있는 엑터로부터 보정을 수신하는 원격 프록시.
        

언리얼 엔진에서 사용하는 기본 모델은 **서버-오소리티(server-authoritative)** 모델로, 서버가 항상 게임 상태에 대한 Authority를 보유합니다. 정보는 서버에서 클라이언트로 리플리케이트되며, 서버의 엑터가 Authority의 로컬 역할을 보유하고, 원격 클라이언트의 엑터는 시뮬레이션된 프록시 또는 자율 프록시 역할을 수행합니다.

참고: [Unreal Engine 네트워크 역할 문서](https://dev.epicgames.com/documentation/ko-kr/unreal-engine/actor-role-and-remote-role-in-unreal-engine?application_version=5.4)

---
# 클라이언트 오너십
## 개요 
네트워크 게임에 있는 **폰**은 특정 클라이언트 컴퓨터의 **플레이어 컨트롤러**가 소유합니다. 폰이 클라이언트 전용 함수를 호출할 때마다, 소유 플레이어의 컴퓨터로만 전달됩니다. 오너 변수가 특정 폰으로 설정된 액터는 연관을 통해 해당 폰의 소유 클라이언트에 속합니다. 또한 이러한 액터는 클라이언트 전용 함수도 오너의 컴퓨터로 전달합니다.

참고: [클라이언트 오너십 문서](https://dev.epicgames.com/documentation/ko-kr/unreal-engine/actor-owner-and-owning-connection-in-unreal-engine?application_version=5.4)
